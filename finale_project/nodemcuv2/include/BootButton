/*! @file BootButton.hpp
 *  @version 3.0.15
*/

#ifndef BOOTBUTTON_HPP
#define BOOTBUTTON_HPP

#include <Arduino.h>
#include <LittleFS.hpp>
#include <pushbutton.h>
#include <variable.h>

class BootButton {
public:
    BootButton(uint8_t pin, uint8_t mode) : bootBtn(pin, mode) { }
    
    void begin() {
        bootBtn.init();
        wifiState = AP_MODE_STATE;
    }
    
    void WiFiMode() {
        currentButtonState = bootBtn.digitalReadPushButton();
        if (currentButtonState != lastButtonState)
            buttonChange = true;

        if (buttonChange) {
            if (currentButtonState == LOW) {
                wifiState = !wifiState;
                lfs_change_config_state.changeconfigState("WIFI_AP", wifiState);
                TSprintln(F("Change Mode WiFi : "));
                TSprintln(wifiState ? "MODE_AP" : "MODE_AP_STA");
                delay(2000);
                ESP.reset();
            }
            buttonChange = false;
        }
        lastButtonState = currentButtonState;
    }
    
private:
    PushButtonDigital bootBtn;
    LFSProgram lfs_change_config_state;
    bool currentButtonState = false;
    bool lastButtonState    = false;
    bool buttonChange       = false;
    bool wifiState          = false;
};

#endif
